{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Return Items</title>
    <link rel="stylesheet" href="{% static 'user/bs462.min.css' %}">

    <style>
     body {
         background-color: #f8f9fa;
     }

     .container {
         max-width: 900px;
     }

     h1, h3, h4 {
         color: #333;
     }

     .card {
         margin-bottom: 20px;
         border: none;
         box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
         border-radius: 10px;
     }

     .card-body {
         padding: 20px;
     }

     table {
         background-color: white;
         border-radius: 10px;
         overflow: hidden;
     }

     .btn-primary {
         background-color: #007bff;
         border-color: #007bff;
     }

     .btn-primary:hover {
         background-color: #0056b3;
         border-color: #004085;
     }

     .btn-danger:hover {
         background-color: #c82333;
         border-color: #bd2130;
     }

     .alert {
         font-size: 16px;
         font-weight: bold;
     }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="text-center mb-4">Return Items for Sale #{{ sale_id }}</h1>

      <div class="card">
        <div class="card-body">
          <h3>Customer Details</h3>
          <p><strong>Name:</strong> {{ customer_name }}</p>
          <p><strong>Address:</strong> {{ customer_address }}</p>
          <p><strong>Mobile:</strong> {{ customer_mobile }}</p>
        </div>
      </div>

      {% if msg %}
      <div class="alert alert-danger text-center">{{ msg }}</div>
      {% endif %}

      <div class="card">
        <div class="card-body">
          <h3>Original Sale Items</h3>
          <table class="table table-bordered mt-3">
            <thead class="thead-dark">
              <tr>
                <th>Item Type</th>
                <th>Purchase Qty</th>
                <th>Price per Unit</th>
                <th>Total Sale Price</th>
                <th>Quantity Left</th>
                <th>Return Quantity</th>
              </tr>
            </thead>
            <tbody>
              {% for item in sale_items %} {% if item.quantity_left > 0 %}
              <tr>
                <td>{{ item.item_type }}</td>
                <td>{{ item.quantity_pur }}</td>
                <td>₹{{ item.sale_price_one }}</td>
                <td>₹{{ item.sale_price }}</td>
                <td>{{ item.quantity_left }}</td>
                <td>
                  <form method="POST" class="form-inline">
                    {% csrf_token %}
                    <input type="hidden" name="item_id" value="{{ item.id }}" />
                    <input
                      type="number"
                      name="return_quantity"
                      class="form-control mr-2"
                      placeholder="Quantity"
                      step="any"
                      max="{{ item.quantity_left }}"
                    />
                    <button type="submit" class="btn btn-primary btn-sm">
                      Return
                    </button>
                  </form>
                </td>
              </tr>
              {% endif %} {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <h3>Returned Items</h3>
          <table class="table table-bordered mt-3">
            <thead class="thead-dark">
              <tr>
                <th>Item Type</th>
                <th>Returned Quantity</th>
                <th>Total Return Price</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for ret_item in return_items %} {% if ret_item.quantity > 0 %}
              <tr>
                <td>{{ ret_item.item_type }}</td>
                <td>{{ ret_item.quantity }}</td>
                <td>₹{{ ret_item.sale_price }}</td>
                <td>
                  <a href="{% url 'delete_return_item' id=ret_item.id sale_id=sale_id %}" class="btn btn-danger">Delete</a>
                </td>
              </tr>
              {% endif %} {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="card-body text-center">
          <h4>Total Return Price: ₹{{ total_return_price }}</h4>
          <div class="mt-4">
            <a
              href="{% url 'clear_return' sale_id=sale_id %}"
              class="btn btn-danger mr-3"
            >
              Clear Return
            </a>
            <a
              href="{% url 'checkout_return' sale_id=sale_id %}"
              class="btn btn-primary"
            >
              Checkout
            </a>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
