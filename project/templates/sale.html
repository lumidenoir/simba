{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sales Page</title>
    <link rel="stylesheet" href="{% static 'user/bs530a3.min.css' %}">
    <style>
     body {
       font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
       background-color: #f8f9fa;
       margin: 0;
       padding: 0;
     }

     .container {
       margin-top: 20px;
     }

     .customer-info {
       display: flex;
       justify-content: space-between;
       gap: 20px;
       margin-bottom: 30px;
     }

     .card {
       background: white;
       border-radius: 10px;
       box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
       padding: 20px;
     }

     .price-details h3,
     .customer-details h3 {
       margin-bottom: 20px;
       font-size: 1.5rem;
     }

     .table-container {
       margin-top: 30px;
     }

     .table-container table {
       border-collapse: separate;
       border-spacing: 0;
       background-color: white;
       box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
       border-radius: 10px;
       overflow: hidden;
       margin: 20px auto;
     }

     table {
       border-collapse: separate;
       border-spacing: 0;
       border-radius: 10px;
       overflow: hidden;
       width: 100%;
     }

     thead {
       background-color: #333;
       color: white;
     }

     thead th {
       text-align: center;
       padding: 12px;
     }

     tbody td {
       text-align: center;
       padding: 12px;
     }

     .btn {
       width: 100%;
       border-radius: 10px;
       margin-top: 10px;
       padding: 10px
     }

     .form-container {
       background: white;
       border-radius: 10px;
       box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
       padding: 20px;
       margin-bottom: 30px;
     }

     .form-container h3 {
       margin-bottom: 20px;
       font-size: 1.5rem;
     }

     .delete-button {
       background-color: #dc3545;
       border: none;
       padding: 5px 10px;
       font-size: 0.9rem;
       border-radius: 5px;
     }

     .btn-success,
     .btn-danger {
       width: 100%;
       margin-top: 20px;
       padding: 10px
     }
     .address-text {
       word-wrap: break-word;
       white-space: normal;
       max-width: 350px;
     }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Customer and Price Information -->
      <div
        class="customer-info d-flex justify-content-between align-items-start"
      >
        <!-- Customer Details -->
        <div class="card customer-details p-3">
          <h3>Customer Details</h3>
          <table class="table table-borderless">
            <tr>
              <td class="text-start"><strong>Name:</strong></td>
              <td class="text-start">{{ customer_name }}</td>
            </tr>
            <tr>
              <td class="text-start"><strong>Mobile:</strong></td>
              <td class="text-start">{{ customer_mobile }}</td>
            </tr>
            <tr>
              <td class="text-start"><strong>Type:</strong></td>
              <td class="text-start">{{ buyer_type }}</td>
            </tr>
            <tr>
              <td class="text-start"><strong>Address:</strong></td>
              <td class="text-start address-text">{{ customer_address }}</td>
            </tr>
          </table>
        </div>

        <!-- Form Container -->
        <div class="form-container mx-3">
          <h3>Add Items to Sale</h3>
          <form action="{% url 'sale' %}" method="POST">
            {% csrf_token %}
            <div class="row g-3 align-items-center">
              <div class="col-md-5">
                <label for="itype" class="form-label">Item Type</label>
                <select class="form-select" name="itype" id="itype" required>
                  <option selected value="0">Select Item</option>
                  {% for item in items %}
                    <option value="{{ item.i_type }}">{{ item.i_type }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="col-md-3">
                <label for="quantity" class="form-label">Quantity</label>
                <input
                  type="number"
                  class="form-control"
                  id="quantity"
                  name="quantity"
                  placeholder="Quantity"
                  step="any"
                  required
                />
              </div>

              <div class="col-md-3">
                <label for="discount" class="form-label">Discount (%)</label>
                <input
                  type="number"
                  class="form-control"
                  id="discount"
                  name="discount"
                  placeholder="Discount"
                  step="any"
                />
              </div>
            </div>
            <div class="text-center mt-3">
              <button type="submit" class="btn btn-primary">Add Item</button>
            </div>
            <h2 class="text-danger text-center">{{ msg }}</h2>
          </form>
        </div>

        <!-- Price Details -->
        <div class="card price-details p-3">
          <h3>Price Summary</h3>
          <table class="table table-borderless">
            <tr>
              <td class="text-start"><strong>Taxable Amount:</strong></td>
              <td class="text-start">₹{{ total_price }}</td>
            </tr>
            <tr>
              <td class="text-start"><strong>GST Amount:</strong></td>
              <td class="text-start">₹{{ total_gst }}</td>
            </tr>
            <tr>
              <td class="text-start"><strong>Total Discount:</strong></td>
              <td class="text-start">₹{{ total_discount }}</td>
            </tr>
            <tr>
              <td class="text-start"><strong>Total Amount:</strong></td>
              <td class="text-start">₹{{ grand_total }}</td>
            </tr>
          </table>
        </div>
      </div>

      <!-- Items in Sale Table -->
      <div class="table-container">
        <table class="table table-bordered table-hover">
          <thead>
            <tr>
              <th>Item Type</th>
              <th>Quantity</th>
              <th>Rate</th>
              <th>Amount</th>
              <th>GST</th>
              <th>Discount</th>
              <th>Sale Price</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for sale in sale_data %}
              <tr>
                <td>{{ sale.item_type }}</td>
                <td>{{ sale.quantity }}</td>
                <td>{{ sale.price }}</td>
                <td>{{ sale.subtotal }}</td>
                <td>{{ sale.gst_subtotal }} ({{ sale.gst }}%)</td>
                <td>{{ sale.discount_amount }} ({{ sale.discount }}%)</td>
                <td>{{ sale.sale_price }}</td>
                <td>
                  <form
                    action="{% url 'delete_sale_item' sale.id %}"
                    method="POST"
                    style="display: inline-block"
                  >
                    {% csrf_token %}
                    <button type="submit" class="delete-button">X</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Checkout and Clear Sale Buttons -->
      <div class="d-flex justify-content-between">
        <form action="{% url 'clear_sale' %}" method="POST">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">Clear Sale</button>
        </form>
        <form action="{% url 'checkout' %}" method="GET">
          <button type="submit" class="btn btn-success">Checkout</button>
        </form>
      </div>
    </div>
  </body>
</html>
